# MIMIC-IV æŠ€èƒ½åˆ›å»ºä¸æ•°æ®åº“è¿æ¥å®Œæ•´æµç¨‹æ€»ç»“

**æ—¥æœŸ**: 2025å¹´11æœˆ14æ—¥
**é¡¹ç›®**: SaAki_Sofa_benchmark - MIMIC-IV æ•°æ®åˆ†æ
**ç›®æ ‡**: åˆ›å»º Claude æŠ€èƒ½å¹¶è¿æ¥æœ¬åœ° MIMIC-IV æ•°æ®åº“

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æŠ€èƒ½åˆ›å»ºæµç¨‹](#æŠ€èƒ½åˆ›å»ºæµç¨‹)
3. [æ•°æ®åº“è¿æ¥é…ç½®](#æ•°æ®åº“è¿æ¥é…ç½®)
4. [æ•°æ®åº“ç»“æ„æ¢ç´¢](#æ•°æ®åº“ç»“æ„æ¢ç´¢)
5. [å…³é”®æˆæœ](#å…³é”®æˆæœ)
6. [åç»­ä½¿ç”¨æŒ‡å—](#åç»­ä½¿ç”¨æŒ‡å—)

---

## é¡¹ç›®æ¦‚è¿°

### ç›®æ ‡
åˆ›å»ºä¸€ä¸ªä¸“é—¨ç”¨äº MIMIC-IV æ•°æ®æå–çš„ Claude AI æŠ€èƒ½ï¼Œå¹¶æˆåŠŸè¿æ¥åˆ°æœ¬åœ° PostgreSQL æ•°æ®åº“è¿›è¡ŒåŒ»å­¦ç ”ç©¶æ•°æ®åˆ†æã€‚

### ç ”ç©¶é‡ç‚¹
- SOFA è¯„åˆ†ï¼ˆåºè´¯å™¨å®˜è¡°ç«­è¯„ä¼°ï¼‰
- è„“æ¯’ç—‡ï¼ˆSepsis-3 æ ‡å‡†ï¼‰
- æ€¥æ€§è‚¾æŸä¼¤ï¼ˆAKI - KDIGO æ ‡å‡†ï¼‰
- ICU æ‚£è€…æ•°æ®åˆ†æ

---

## æŠ€èƒ½åˆ›å»ºæµç¨‹

### ç¬¬ä¸€æ­¥ï¼šå®‰è£… Skill-Seekers å·¥å…·

**å·¥å…·ä»‹ç»**ï¼š
Skill-Seekers æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–å·¥å…·ï¼Œå¯ä»¥å°†æ–‡æ¡£ç½‘ç«™ã€GitHub ä»“åº“å’Œ PDF æ–‡ä»¶è½¬æ¢ä¸º Claude AI æŠ€èƒ½ã€‚

**å®‰è£…å‘½ä»¤**ï¼š
```bash
pip install skill-seekers
```

**å®‰è£…ç»“æœ**ï¼š
- âœ… æˆåŠŸå®‰è£… skill-seekers 2.1.0
- âœ… åŒ…å«ä¾èµ–ï¼šrequests, beautifulsoup4, PyGithub, mcp, httpx-sse ç­‰

**ä¸»è¦åŠŸèƒ½**ï¼š
- ä»æ–‡æ¡£ç½‘ç«™æŠ“å–å†…å®¹
- ä» GitHub ä»“åº“æå–ä»£ç å’Œæ–‡æ¡£
- ä» PDF æå–ä¿¡æ¯
- è‡ªåŠ¨ç”Ÿæˆ Claude æŠ€èƒ½åŒ…

---

### ç¬¬äºŒæ­¥ï¼šè·å– MIMIC-IV å®˜æ–¹èµ„æº

**æ•°æ®æºæ”¶é›†**ï¼š

1. **å®˜æ–¹æ–‡æ¡£**ï¼šhttps://mimic.mit.edu/docs/iv/
   - æ•°æ®åº“æ¨¡å—è¯´æ˜ï¼ˆhosp, icu, ed, cxrï¼‰
   - è¡¨ç»“æ„æ–‡æ¡£
   - ä½¿ç”¨æ•™ç¨‹

2. **GitHub ä»£ç ä»“åº“**ï¼šhttps://github.com/MIT-LCP/mimic-code
   - SQL æŸ¥è¯¢ç¤ºä¾‹
   - ä¸´åºŠæ¦‚å¿µå®ç°ï¼ˆSOFAã€Sepsisã€AKIï¼‰
   - æ•°æ®æå–è„šæœ¬

**æŠ“å–è¿‡ç¨‹**ï¼š
```bash
# å°è¯•ä»æ–‡æ¡£ç½‘ç«™æŠ“å–
skill-seekers scrape --url https://mimic.mit.edu/docs/iv/ --name mimiciv-data-extraction

# å°è¯•ä» GitHub æŠ“å–
skill-seekers github --repo MIT-LCP/mimic-code --name mimiciv-data-extraction
```

**é‡åˆ°çš„é—®é¢˜**ï¼š
- GitHub æŠ“å–å™¨å‡ºç° logger é”™è¯¯
- æ–‡æ¡£ç½‘ç«™æŠ“å–å†…å®¹æœ‰é™

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ‰‹åŠ¨ä½¿ç”¨ WebFetch å·¥å…·è·å–å…³é”®æ–‡æ¡£å†…å®¹
- åŸºäºå®˜æ–¹èµ„æºæ‰‹å·¥åˆ›å»ºæŠ€èƒ½æ–‡ä»¶

---

### ç¬¬ä¸‰æ­¥ï¼šæ‰‹å·¥åˆ›å»º MIMIC-IV æŠ€èƒ½

**åˆ›å»ºä½ç½®**ï¼š`.claude/skills/mimiciv-data-extraction/`

**åŒ…å«æ–‡ä»¶**ï¼š

#### 1. `SKILL.md` (28KB) - æ ¸å¿ƒæŠ€èƒ½å†…å®¹

**åŒ…å«ç« èŠ‚**ï¼š
- æ•°æ®åº“ç»“æ„æ¦‚è¿°ï¼ˆ5ä¸ªæ¨¡å—ï¼‰
- åŸºç¡€è¡¨è¯´æ˜ï¼ˆ30+ æ ¸å¿ƒè¡¨ï¼‰
- ä¸´åºŠæ¦‚å¿µå®ç°
  - SOFA è¯„åˆ†ï¼ˆ6ä¸ªç»„ä»¶å®Œæ•´å®ç°ï¼‰
  - Sepsis-3 æ ‡å‡†ï¼ˆæ„ŸæŸ“ + å™¨å®˜åŠŸèƒ½éšœç¢ï¼‰
  - KDIGO AKI åˆ†æœŸï¼ˆè‚Œé… + å°¿é‡æ ‡å‡†ï¼‰
  - æœºæ¢°é€šæ°”æ£€æµ‹
  - é¦–æ—¥æµ‹é‡å€¼
- æ•°æ®æå–æ¨¡å¼
  - æ‚£è€…é˜Ÿåˆ—é€‰æ‹©
  - æ—¶é—´åºåˆ—æ•°æ®æå–
  - å®éªŒå®¤æ•°æ®å¤„ç†
  - è¯ç‰©æš´éœ²çª—å£
- ItemID å‚è€ƒæŒ‡å—
  - ç”Ÿå‘½ä½“å¾ itemidï¼ˆå¿ƒç‡ã€è¡€å‹ã€SpO2 ç­‰ï¼‰
  - å®éªŒå®¤æ£€æŸ¥ itemidï¼ˆè‚Œé…ã€è¡€å°æ¿ã€èƒ†çº¢ç´ ç­‰ï¼‰
  - å‘¼å¸æœºè®¾ç½® itemid
- æ€§èƒ½ä¼˜åŒ–æŠ€å·§
- æ•°æ®è´¨é‡å¤„ç†
- å¸¸è§ç ”ç©¶ç”¨ä¾‹

#### 2. `skill.json` (1.7KB) - æŠ€èƒ½å…ƒæ•°æ®

```json
{
  "name": "mimiciv-data-extraction",
  "version": "1.0.0",
  "description": "å…¨é¢çš„ MIMIC-IV æ•°æ®åº“åˆ†ææŠ€èƒ½",
  "tags": ["mimic-iv", "medical-data", "sql", "postgresql",
           "clinical-research", "icu", "sepsis", "sofa-score", "aki"],
  "categories": [
    "Database Schema",
    "Data Extraction",
    "SQL Queries",
    "Clinical Concepts",
    "Table Relationships"
  ]
}
```

#### 3. `README.md` (5.2KB) - ä½¿ç”¨æŒ‡å—

åŒ…å«ï¼š
- æŠ€èƒ½æ¦‚è¿°
- ä½¿ç”¨æ–¹æ³•
- å¿«é€Ÿå‚è€ƒæŸ¥è¯¢
- ç¤ºä¾‹ç”¨ä¾‹
- ä¸é¡¹ç›®çš„é›†æˆè¯´æ˜

---

### ç¬¬å››æ­¥ï¼šæŠ€èƒ½å†…å®¹äº®ç‚¹

#### ğŸ“Š å®Œæ•´çš„è¡¨ç»“æ„æ–‡æ¡£

**Hospital æ¨¡å— (mimiciv_hosp)**ï¼š
- `patients` - æ‚£è€…äººå£ç»Ÿè®¡å­¦ä¿¡æ¯
- `admissions` - ä½é™¢è¯¦æƒ…
- `labevents` - å®éªŒå®¤æ£€æŸ¥ï¼ˆ1.58äº¿æ¡è®°å½•ï¼‰
- `prescriptions` - è¯ç‰©å¤„æ–¹
- `diagnoses_icd` - ICD è¯Šæ–­ä»£ç 
- `microbiologyevents` - å¾®ç”Ÿç‰©åŸ¹å…»ç»“æœ

**ICU æ¨¡å— (mimiciv_icu)**ï¼š
- `icustays` - ICU ä½é™¢ä¿¡æ¯
- `chartevents` - ICU å›¾è¡¨äº‹ä»¶ï¼ˆ4.33äº¿æ¡è®°å½•ï¼‰
- `inputevents` - è¾“å…¥äº‹ä»¶ï¼ˆè¯ç‰©ã€æ¶²ä½“ï¼‰
- `outputevents` - è¾“å‡ºäº‹ä»¶ï¼ˆå°¿é‡ã€å¼•æµï¼‰
- `d_items` - ICU é¡¹ç›®å­—å…¸

#### ğŸ” ItemID é€ŸæŸ¥è¡¨

**ç”Ÿå‘½ä½“å¾**ï¼š
```sql
220045  -- å¿ƒç‡ (Heart Rate)
220210  -- å‘¼å¸é¢‘ç‡ (Respiratory Rate)
220277  -- SpO2 (æ°§é¥±å’Œåº¦)
220181  -- å¹³å‡åŠ¨è„‰å‹ (MAP)
220179  -- æ”¶ç¼©å‹ (Systolic BP)
220180  -- èˆ’å¼ å‹ (Diastolic BP)
223761  -- ä½“æ¸© (åæ°åº¦)
```

**å®éªŒå®¤æ£€æŸ¥**ï¼š
```sql
50912   -- è‚Œé… (Creatinine)
51265   -- è¡€å°æ¿ (Platelets)
50885   -- èƒ†çº¢ç´  (Bilirubin)
51222   -- è¡€çº¢è›‹ç™½ (Hemoglobin)
51301   -- ç™½ç»†èƒ (WBC)
```

#### ğŸ’¡ é¢„æ„å»ºçš„ SQL æ¨¡å¼

**SOFA è¯„åˆ†è®¡ç®—**ï¼š
```sql
-- SOFA è‚¾åŠŸèƒ½ç»„åˆ†ï¼ˆåŸºäºè‚Œé…ï¼‰
CASE
    WHEN creatinine >= 5.0 THEN 4
    WHEN creatinine >= 3.5 THEN 3
    WHEN creatinine >= 2.0 THEN 2
    WHEN creatinine >= 1.2 THEN 1
    ELSE 0
END as sofa_renal_score
```

**è„“æ¯’ç—‡æ£€æµ‹ï¼ˆSepsis-3ï¼‰**ï¼š
- æ„ŸæŸ“æ€€ç–‘ï¼šæŠ—ç”Ÿç´  + åŸ¹å…»ï¼ˆ24å°æ—¶å†…ï¼‰
- å™¨å®˜åŠŸèƒ½éšœç¢ï¼šSOFA â‰¥ 2åˆ†

**AKI åˆ†æœŸï¼ˆKDIGOï¼‰**ï¼š
```sql
-- Stage 1: è‚Œé…å¢åŠ  â‰¥0.3 æˆ– â‰¥1.5å€åŸºçº¿
-- Stage 2: è‚Œé… â‰¥2å€åŸºçº¿
-- Stage 3: è‚Œé… â‰¥3å€åŸºçº¿
```

---

## æ•°æ®åº“è¿æ¥é…ç½®

### ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒå‡†å¤‡

**ç³»ç»Ÿç¯å¢ƒ**ï¼š
- WSL (Windows Subsystem for Linux)
- Windows PostgreSQL æœåŠ¡å™¨
- Python ç¯å¢ƒï¼šrna-seq (conda)

**ç½‘ç»œé…ç½®**ï¼š
- Windows ä¸»æœº IPï¼š`172.19.160.1`
- PostgreSQL ç«¯å£ï¼š`5432`
- æ•°æ®åº“åï¼š`mimiciv`

---

### ç¬¬äºŒæ­¥ï¼šé…ç½®æ•°æ®åº“è¿æ¥

**ä¿®æ”¹æ–‡ä»¶**ï¼š`utils/db_helper.py`

**å…³é”®ä¿®æ”¹**ï¼š

1. **å›ºå®š Windows IP åœ°å€**ï¼š
```python
def get_windows_ip():
    """è‡ªåŠ¨è·å–Windowsä¸»æœºIP"""
    # å›ºå®š IP åœ°å€
    return '172.19.160.1'
```

2. **é…ç½®æ•°æ®åº“å‡­è¯**ï¼š
```python
DB_CONFIG = {
    'mimic': {
        'host': WINDOWS_HOST,
        'port': 5432,
        'database': 'mimiciv',
        'user': 'postgres',
        'password': '188211'
    }
}
```

---

### ç¬¬ä¸‰æ­¥ï¼šå®‰è£… Python ä¾èµ–

**æ¿€æ´» conda ç¯å¢ƒå¹¶å®‰è£…**ï¼š
```bash
conda activate rna-seq
pip install psycopg2-binary sqlalchemy
```

**å®‰è£…çš„åŒ…**ï¼š
- `psycopg2-binary` - PostgreSQL æ•°æ®åº“é€‚é…å™¨
- `sqlalchemy` - SQL å·¥å…·åŒ…å’Œ ORM
- `pandas` - æ•°æ®åˆ†æåº“ï¼ˆå·²å­˜åœ¨ï¼‰

---

### ç¬¬å››æ­¥ï¼šæµ‹è¯•è¿æ¥

**æµ‹è¯•å‘½ä»¤**ï¼š
```bash
python -c "from utils.db_helper import test_connection; test_connection('mimic')"
```

**æˆåŠŸè¾“å‡º**ï¼š
```
ğŸ”— æµ‹è¯•è¿æ¥åˆ° mimic æ•°æ®åº“...
   ä¸»æœº: 172.19.160.1
   ç«¯å£: 5432
   æ•°æ®åº“: mimiciv
âœ… è¿æ¥æˆåŠŸï¼
```

---

## æ•°æ®åº“ç»“æ„æ¢ç´¢

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæ¢ç´¢è„šæœ¬

**è„šæœ¬ä½ç½®**ï¼š`scripts/explore_mimiciv_database.py`

**åŠŸèƒ½**ï¼š
1. å‘ç°æ‰€æœ‰ schemas
2. åˆ—å‡ºæ‰€æœ‰è¡¨åŠå¤§å°
3. è·å–è¡Œæ•°ç»Ÿè®¡
4. æ£€æŸ¥å…³é”®è¡¨ç»“æ„
5. åˆ†æè¡¨å…³ç³»
6. ç”Ÿæˆæ•°æ®åº“æ‘˜è¦

---

### ç¬¬äºŒæ­¥ï¼šæ‰§è¡Œæ¢ç´¢

**è¿è¡Œå‘½ä»¤**ï¼š
```bash
conda activate rna-seq
python scripts/explore_mimiciv_database.py
```

**æ¢ç´¢ç»“æœ**ï¼š

#### ğŸ“Š Schema ç»Ÿè®¡

| Schema | è¡¨æ•°é‡ | è¯´æ˜ |
|--------|-------|------|
| **mimiciv_hosp** | 29 | åŒ»é™¢æ•°æ® |
| **mimiciv_icu** | 10 | ICU æ•°æ® |
| **mimiciv_derived** | 72 | é¢„è®¡ç®—çš„æ´¾ç”Ÿè¡¨ |
| **æ€»è®¡** | **111** | å…¨éƒ¨è¡¨ |

#### ğŸ“ˆ æ•°æ®é‡ç»Ÿè®¡

**æ ¸å¿ƒè¡¨**ï¼š
- æ‚£è€…ï¼ˆpatientsï¼‰ï¼š364,627 äºº
- ä½é™¢ï¼ˆadmissionsï¼‰ï¼š546,028 æ¬¡
- ICU ä½é™¢ï¼ˆicustaysï¼‰ï¼š94,458 æ¬¡

**åŒ»é™¢æ•°æ®**ï¼š
- å®éªŒå®¤äº‹ä»¶ï¼ˆlabeventsï¼‰ï¼š158,478,383 æ¡
- å¤„æ–¹ï¼ˆprescriptionsï¼‰ï¼š20,292,611 æ¡
- è¯Šæ–­ä»£ç ï¼ˆdiagnoses_icdï¼‰ï¼š6,364,520 æ¡
- å¾®ç”Ÿç‰©äº‹ä»¶ï¼ˆmicrobiologyeventsï¼‰ï¼š3,988,224 æ¡

**ICU æ•°æ®**ï¼š
- å›¾è¡¨äº‹ä»¶ï¼ˆcharteventsï¼‰ï¼š432,997,491 æ¡ï¼ˆæœ€å¤§è¡¨ï¼ï¼‰
- è¾“å…¥äº‹ä»¶ï¼ˆinputeventsï¼‰ï¼š10,953,713 æ¡
- è¾“å‡ºäº‹ä»¶ï¼ˆoutputeventsï¼‰ï¼š5,359,395 æ¡

**æ´¾ç”Ÿè¡¨ï¼ˆé¢„è®¡ç®—ï¼‰**ï¼š
- SOFA è¯„åˆ†ï¼ˆsofaï¼‰ï¼š8,219,121 æ¡
- Sepsis-3 ç—…ä¾‹ï¼ˆsepsis3ï¼‰ï¼š41,295 ä¾‹
- KDIGO AKI åˆ†æœŸï¼ˆkdigo_stagesï¼‰ï¼š5,099,899 æ¡

---

### ç¬¬ä¸‰æ­¥ï¼šå…³é”®å‘ç°

#### â­ é‡è¦å‘ç°ï¼šæœ‰é¢„è®¡ç®—è¡¨ï¼

**æ„ä¹‰**ï¼šä½ çš„æ•°æ®åº“åŒ…å«å·²ç»è®¡ç®—å¥½çš„ä¸´åºŠæ¦‚å¿µè¡¨ï¼Œ**ä¸éœ€è¦ä»å¤´è®¡ç®—**ï¼

**å¯ç”¨çš„é¢„è®¡ç®—è¡¨**ï¼š

1. **SOFA è¯„åˆ†**
   - `sofa` - å®Œæ•´æ—¶é—´åºåˆ—ï¼ˆ820ä¸‡æ¡ï¼‰
   - `first_day_sofa` - é¦–æ—¥ SOFAï¼ˆ94,458æ¡ï¼Œæ¯ä¸ª ICU ä½é™¢ä¸€æ¡ï¼‰

2. **è„“æ¯’ç—‡**
   - `sepsis3` - å·²è¯†åˆ«çš„ Sepsis-3 ç—…ä¾‹ï¼ˆ41,295ä¾‹ï¼‰
   - `sepsis3_detail` - è¯¦ç»†è„“æ¯’ç—‡ä¿¡æ¯
   - `suspicion_of_infection` - æ„ŸæŸ“æ€€ç–‘æŒ‡æ ‡

3. **æ€¥æ€§è‚¾æŸä¼¤**
   - `kdigo_stages` - KDIGO AKI åˆ†æœŸï¼ˆ510ä¸‡æ¡ï¼‰
   - `kdigo_creatinine` - åŸºäºè‚Œé…çš„ AKI
   - `kdigo_uo` - åŸºäºå°¿é‡çš„ AKI

4. **é¦–æ—¥æµ‹é‡å€¼**
   - `first_day_lab` - é¦–æ—¥å®éªŒå®¤å€¼
   - `first_day_vitalsign` - é¦–æ—¥ç”Ÿå‘½ä½“å¾
   - `first_day_urine_output` - é¦–æ—¥å°¿é‡
   - `first_day_gcs` - é¦–æ—¥ GCS è¯„åˆ†

5. **è¯ç‰©**
   - `norepinephrine` - å»ç”²è‚¾ä¸Šè…ºç´ 
   - `vasopressin` - åŠ å‹ç´ 
   - `vasoactive_agent` - æ‰€æœ‰è¡€ç®¡æ´»æ€§è¯ç‰©

6. **å‘¼å¸æ”¯æŒ**
   - `ventilation` - æœºæ¢°é€šæ°”æ—¶æ®µ
   - `ventilator_setting` - å‘¼å¸æœºè®¾ç½®

7. **å…¶ä»–è¯„åˆ†**
   - `apsiii` - APACHE III
   - `sapsii` - SAPS II
   - `oasis` - OASIS
   - `charlson` - Charlson åˆå¹¶ç—‡æŒ‡æ•°

---

### ç¬¬å››æ­¥ï¼šè¡¨å…³ç³»åˆ†æ

**å¤–é”®å…³ç³»**ï¼š
```
mimiciv_hosp.patients.subject_id (ä¸»é”®)
    â†“
mimiciv_hosp.admissions (subject_id, hadm_id)
    â†“
mimiciv_icu.icustays (subject_id, hadm_id, stay_id)
    â†“
mimiciv_icu.chartevents (subject_id, hadm_id, stay_id, itemid)
mimiciv_hosp.labevents (subject_id, hadm_id, itemid)
```

**å­—å…¸è¡¨**ï¼š
- `d_items` - ICU é¡¹ç›®å®šä¹‰ï¼ˆ4,095é¡¹ï¼‰
- `d_labitems` - å®éªŒå®¤é¡¹ç›®å®šä¹‰ï¼ˆ1,650é¡¹ï¼‰
- `d_icd_diagnoses` - ICD è¯Šæ–­ä»£ç å­—å…¸
- `d_icd_procedures` - ICD æ“ä½œä»£ç å­—å…¸

---

## å…³é”®æˆæœ

### âœ… åˆ›å»ºçš„æ–‡ä»¶å’Œå·¥å…·

#### 1. æŠ€èƒ½æ–‡ä»¶
```
.claude/skills/mimiciv-data-extraction/
â”œâ”€â”€ SKILL.md          (28KB) - å®Œæ•´æŠ€èƒ½å†…å®¹
â”œâ”€â”€ skill.json        (1.7KB) - æŠ€èƒ½å…ƒæ•°æ®
â””â”€â”€ README.md         (5.2KB) - ä½¿ç”¨æŒ‡å—
```

#### 2. é…ç½®æ–‡ä»¶
```
utils/
â””â”€â”€ db_helper.py      - æ•°æ®åº“è¿æ¥å·¥å…·ï¼ˆå·²é…ç½®ï¼‰
```

#### 3. è„šæœ¬æ–‡ä»¶
```
scripts/
â”œâ”€â”€ explore_mimiciv_database.py   - æ•°æ®åº“æ¢ç´¢è„šæœ¬
â””â”€â”€ get_actual_row_counts.py      - è¡Œæ•°ç»Ÿè®¡è„šæœ¬
```

#### 4. æ–‡æ¡£æ–‡ä»¶
```
MIMICIV_Database_Summary.md       - æ•°æ®åº“æ‘˜è¦ï¼ˆè‹±æ–‡ï¼‰
é…ç½®æ­¥éª¤_PostgreSQLè¿æ¥.md          - PostgreSQL è¿æ¥æŒ‡å—
docs/å®Œæ•´æµç¨‹æ–‡æ¡£/
â””â”€â”€ 01_å®Œæ•´æµç¨‹æ€»ç»“.md              - æœ¬æ–‡æ¡£
```

#### 5. ç¤ºä¾‹è„šæœ¬
```
examples/
â”œâ”€â”€ skill_demonstration.py         - æŠ€èƒ½æ¼”ç¤ºè„šæœ¬
â”œâ”€â”€ quick_query_example.py         - å¿«é€ŸæŸ¥è¯¢ç¤ºä¾‹
â””â”€â”€ count_sa_aki.py                - SA-AKI ç»Ÿè®¡
```

---

### ğŸ“Š æ•°æ®åº“è¿æ¥çŠ¶æ€

**âœ… å·²æˆåŠŸé…ç½®**ï¼š
- ä¸»æœºï¼š172.19.160.1
- ç«¯å£ï¼š5432
- æ•°æ®åº“ï¼šmimiciv
- ç”¨æˆ·ï¼špostgres
- çŠ¶æ€ï¼šå·²è¿æ¥å¹¶æµ‹è¯•

**âœ… å¯ç”¨æ•°æ®**ï¼š
- 364,627 æ‚£è€…
- 546,028 ä½é™¢è®°å½•
- 94,458 ICU ä½é™¢
- 41,295 è„“æ¯’ç—‡ç—…ä¾‹ï¼ˆå·²è¯†åˆ«ï¼‰
- è¶…è¿‡ 6.2 äº¿ä¸´åºŠäº‹ä»¶

---

### ğŸ¯ æŠ€èƒ½åŠŸèƒ½

**âœ… æä¾›çš„èƒ½åŠ›**ï¼š
1. å®Œæ•´çš„è¡¨ç»“æ„æ–‡æ¡£ï¼ˆ111ä¸ªè¡¨ï¼‰
2. ItemID å¿«é€Ÿå‚è€ƒï¼ˆç”Ÿå‘½ä½“å¾ã€å®éªŒå®¤ã€è¯ç‰©ï¼‰
3. ä¸´åºŠæ¦‚å¿µ SQL å®ç°ï¼ˆSOFAã€Sepsisã€AKIï¼‰
4. æ•°æ®æå–æ¨¡å¼ï¼ˆé˜Ÿåˆ—é€‰æ‹©ã€æ—¶é—´åºåˆ—ã€å®éªŒå®¤æ•°æ®ï¼‰
5. æ€§èƒ½ä¼˜åŒ–å»ºè®®ï¼ˆç´¢å¼•ã€æŸ¥è¯¢ä¼˜åŒ–ï¼‰
6. æ•°æ®è´¨é‡å¤„ç†ï¼ˆç¼ºå¤±å€¼ã€å¼‚å¸¸å€¼ã€é‡å¤è®°å½•ï¼‰

---

## åç»­ä½¿ç”¨æŒ‡å—

### æ–¹å¼ä¸€ï¼šä½¿ç”¨é¢„è®¡ç®—è¡¨ï¼ˆæ¨èï¼Œæœ€å¿«ï¼‰

**ç¤ºä¾‹ï¼šè·å–è„“æ¯’ç—‡æ‚£è€…**
```python
from utils.db_helper import query_to_df

# ç›´æ¥ä»é¢„è®¡ç®—è¡¨è·å–
sepsis_df = query_to_df("""
    SELECT
        s.subject_id,
        s.hadm_id,
        s.stay_id,
        s.sepsis3,
        s.sofa_24hours,
        s.sofa_time
    FROM mimiciv_derived.sepsis3 s
    WHERE s.sepsis3 = true
    LIMIT 100;
""", db='mimic')

print(f"æ‰¾åˆ° {len(sepsis_df)} ä¸ªè„“æ¯’ç—‡ç—…ä¾‹")
```

**ç¤ºä¾‹ï¼šè·å–é¦–æ—¥ SOFA è¯„åˆ†**
```python
sofa_df = query_to_df("""
    SELECT
        stay_id,
        sofa_24hours as total_sofa,
        respiration_24hours,
        coagulation_24hours,
        liver_24hours,
        cardiovascular_24hours,
        cns_24hours,
        renal_24hours
    FROM mimiciv_derived.first_day_sofa
    WHERE sofa_24hours >= 2
    LIMIT 100;
""", db='mimic')
```

**ç¤ºä¾‹ï¼šè·å– AKI æ‚£è€…**
```python
aki_df = query_to_df("""
    SELECT
        stay_id,
        charttime,
        aki_stage,
        creatinine,
        uo_24hr
    FROM mimiciv_derived.kdigo_stages
    WHERE aki_stage >= 1
    LIMIT 100;
""", db='mimic')
```

---

### æ–¹å¼äºŒï¼šä»åŸå§‹æ•°æ®æ„å»ºï¼ˆä½¿ç”¨æŠ€èƒ½æ¨¡å¼ï¼‰

**ç¤ºä¾‹ï¼šæ„å»ºæˆäºº ICU æ‚£è€…é˜Ÿåˆ—**
```python
cohort_df = query_to_df("""
    -- æŠ€èƒ½æ¨¡å¼ï¼šæ‚£è€…é˜Ÿåˆ—é€‰æ‹©
    SELECT
        ie.subject_id,
        ie.hadm_id,
        ie.stay_id,
        ie.intime,
        ie.outtime,
        ie.los,
        p.gender,
        p.anchor_age,
        a.hospital_expire_flag
    FROM mimiciv_icu.icustays ie
    INNER JOIN mimiciv_hosp.patients p
        ON ie.subject_id = p.subject_id
    INNER JOIN mimiciv_hosp.admissions a
        ON ie.hadm_id = a.hadm_id
    WHERE p.anchor_age >= 18  -- æˆäººæ‚£è€…
      AND ie.los >= 1         -- è‡³å°‘ä½é™¢1å¤©
    LIMIT 100;
""", db='mimic')
```

**ç¤ºä¾‹ï¼šæå–ç”Ÿå‘½ä½“å¾æ—¶é—´åºåˆ—**
```python
vitals_df = query_to_df("""
    -- æŠ€èƒ½æ¨¡å¼ï¼šæ—¶é—´åºåˆ—ç”Ÿå‘½ä½“å¾
    -- ä½¿ç”¨æŠ€èƒ½æä¾›çš„ itemid
    SELECT
        ce.stay_id,
        ce.charttime,
        MAX(CASE WHEN ce.itemid = 220045 THEN ce.valuenum END) as heart_rate,
        MAX(CASE WHEN ce.itemid = 220210 THEN ce.valuenum END) as resp_rate,
        MAX(CASE WHEN ce.itemid = 220277 THEN ce.valuenum END) as spo2,
        MAX(CASE WHEN ce.itemid = 220181 THEN ce.valuenum END) as map
    FROM mimiciv_icu.chartevents ce
    WHERE ce.stay_id = 30000001
      AND ce.itemid IN (220045, 220210, 220277, 220181)
    GROUP BY ce.stay_id, ce.charttime
    ORDER BY ce.charttime;
""", db='mimic')
```

---

### æ–¹å¼ä¸‰ï¼šç»„åˆä½¿ç”¨

**ç¤ºä¾‹ï¼šè„“æ¯’ç—‡æ‚£è€…çš„ SOFA + AKI**
```python
combined_df = query_to_df("""
    SELECT
        s.stay_id,
        s.sepsis3,
        s.sofa_24hours,
        fs.respiration_24hours,
        fs.coagulation_24hours,
        fs.liver_24hours,
        fs.cardiovascular_24hours,
        fs.cns_24hours,
        fs.renal_24hours,
        k.aki_stage,
        ie.los,
        p.anchor_age,
        a.hospital_expire_flag
    FROM mimiciv_derived.sepsis3 s
    INNER JOIN mimiciv_derived.first_day_sofa fs
        ON s.stay_id = fs.stay_id
    LEFT JOIN (
        SELECT stay_id, MAX(aki_stage) as aki_stage
        FROM mimiciv_derived.kdigo_stages
        GROUP BY stay_id
    ) k ON s.stay_id = k.stay_id
    INNER JOIN mimiciv_icu.icustays ie
        ON s.stay_id = ie.stay_id
    INNER JOIN mimiciv_hosp.patients p
        ON s.subject_id = p.subject_id
    INNER JOIN mimiciv_hosp.admissions a
        ON s.hadm_id = a.hadm_id
    WHERE s.sepsis3 = true
    LIMIT 100;
""", db='mimic')

print(f"è„“æ¯’ç—‡æ‚£è€…ï¼š{len(combined_df)}")
print(f"åˆå¹¶ AKIï¼š{(combined_df['aki_stage'] >= 1).sum()}")
```

---

### å¿«é€Ÿå¼€å§‹æ¨¡æ¿

**åˆ›å»ºæ–°çš„åˆ†æè„šæœ¬**ï¼š
```python
"""
æˆ‘çš„ MIMIC-IV æ•°æ®åˆ†æ
"""
import sys
import os
sys.path.insert(0, os.path.join(os.path.dirname(__file__), '..'))

from utils.db_helper import query_to_df
import pandas as pd

# æµ‹è¯•è¿æ¥
from utils.db_helper import test_connection
if not test_connection('mimic'):
    print("âŒ æ•°æ®åº“è¿æ¥å¤±è´¥")
    sys.exit(1)

# ä½ çš„åˆ†æä»£ç 
sql = """
    -- åœ¨è¿™é‡Œå†™ä½ çš„ SQL æŸ¥è¯¢
    -- å¯ä»¥å‚è€ƒ .claude/skills/mimiciv-data-extraction/SKILL.md
    SELECT * FROM mimiciv_derived.sepsis3
    WHERE sepsis3 = true
    LIMIT 10;
"""

df = query_to_df(sql, db='mimic')
print(df)

# ä¿å­˜ç»“æœ
df.to_csv('output/my_analysis.csv', index=False)
```

---

### ä½¿ç”¨æŠ€èƒ½è·å¾—å¸®åŠ©

**åœ¨ Claude Code ä¸­**ï¼š
```
"ä½¿ç”¨ MIMIC-IV æŠ€èƒ½ï¼Œå¸®æˆ‘æå–è„“æ¯’ç—‡æ‚£è€…çš„é¦–æ—¥ SOFA è¯„åˆ†"

"æ ¹æ® MIMIC-IV æŠ€èƒ½ï¼Œå¦‚ä½•è®¡ç®— AKI çš„ KDIGO åˆ†æœŸï¼Ÿ"

"ç”¨ MIMIC-IV æŠ€èƒ½çš„æ¨¡å¼ï¼Œæ„å»ºä¸€ä¸ªåŒ…å«ç”Ÿå‘½ä½“å¾çš„æ‚£è€…é˜Ÿåˆ—"
```

**æŸ¥çœ‹æŠ€èƒ½æ–‡æ¡£**ï¼š
```bash
# æŸ¥çœ‹å®Œæ•´æŠ€èƒ½æ–‡æ¡£
cat .claude/skills/mimiciv-data-extraction/SKILL.md

# æŸ¥çœ‹å¿«é€ŸæŒ‡å—
cat .claude/skills/mimiciv-data-extraction/README.md
```

---

## é‡è¦æ–‡ä»¶ä½ç½®

### æŠ€èƒ½æ–‡ä»¶
- `.claude/skills/mimiciv-data-extraction/SKILL.md` - å®Œæ•´æŠ€èƒ½æ–‡æ¡£
- `.claude/skills/mimiciv-data-extraction/README.md` - å¿«é€ŸæŒ‡å—
- `.claude/skills/mimiciv-data-extraction/skill.json` - å…ƒæ•°æ®

### æ•°æ®åº“å·¥å…·
- `utils/db_helper.py` - æ•°æ®åº“è¿æ¥å’ŒæŸ¥è¯¢å·¥å…·
- `scripts/explore_mimiciv_database.py` - æ•°æ®åº“æ¢ç´¢è„šæœ¬
- `scripts/get_actual_row_counts.py` - è¡Œæ•°ç»Ÿè®¡è„šæœ¬

### æ–‡æ¡£
- `MIMICIV_Database_Summary.md` - æ•°æ®åº“æ‘˜è¦ï¼ˆè‹±æ–‡ï¼‰
- `é…ç½®æ­¥éª¤_PostgreSQLè¿æ¥.md` - è¿æ¥é…ç½®æŒ‡å—
- `docs/å®Œæ•´æµç¨‹æ–‡æ¡£/01_å®Œæ•´æµç¨‹æ€»ç»“.md` - æœ¬æ–‡æ¡£ï¼ˆä¸­æ–‡ï¼‰

### é…ç½®
- `configs/mimiciv_unified.json` - Skill-seekers é…ç½®ï¼ˆæœªä½¿ç”¨ï¼‰

---

## æŠ€æœ¯ç»†èŠ‚æ€»ç»“

### ä½¿ç”¨çš„å·¥å…·
1. **skill-seekers** - Claude æŠ€èƒ½åˆ›å»ºå·¥å…·
2. **PostgreSQL** - æ•°æ®åº“æœåŠ¡å™¨ï¼ˆWindowsï¼‰
3. **psycopg2-binary** - Python PostgreSQL é€‚é…å™¨
4. **SQLAlchemy** - SQL å·¥å…·åŒ…
5. **pandas** - æ•°æ®åˆ†æåº“

### Python ç¯å¢ƒ
- **Conda ç¯å¢ƒ**: rna-seq
- **Python ç‰ˆæœ¬**: 3.10
- **æ“ä½œç³»ç»Ÿ**: WSL (Linux on Windows)

### ç½‘ç»œé…ç½®
- **Windows IP**: 172.19.160.1
- **PostgreSQL ç«¯å£**: 5432
- **æ•°æ®åº“**: mimiciv
- **ç”¨æˆ·**: postgres

### æ•°æ®è§„æ¨¡
- **æ€»è¡¨æ•°**: 111
- **æ€»è¡Œæ•°**: çº¦ 6.2 äº¿
- **æ•°æ®åº“å¤§å°**: çº¦ 80 GB
- **æœ€å¤§è¡¨**: chartevents (4.33 äº¿è¡Œ)

---

## ä¸‹ä¸€æ­¥å»ºè®®

### ç«‹å³å¯åš
1. âœ… ä½¿ç”¨é¢„è®¡ç®—è¡¨å¿«é€Ÿå¼€å§‹åˆ†æ
2. âœ… å‚è€ƒæŠ€èƒ½æ–‡æ¡£ç¼–å†™ SQL æŸ¥è¯¢
3. âœ… ä½¿ç”¨ `db_helper.py` è¿›è¡Œæ•°æ®æå–

### ç ”ç©¶æ–¹å‘
1. **è„“æ¯’ç—‡åˆ†æ**
   - ä½¿ç”¨ `mimiciv_derived.sepsis3` è¡¨
   - ç»“åˆ SOFA è¯„åˆ†åˆ†æä¸¥é‡ç¨‹åº¦
   - åˆ†æé¢„åå› ç´ 

2. **AKI ç ”ç©¶**
   - ä½¿ç”¨ `mimiciv_derived.kdigo_stages` è¡¨
   - åˆ†æ AKI å‘ç”Ÿç‡å’Œå±é™©å› ç´ 
   - ç ”ç©¶ AKI ä¸é¢„åçš„å…³ç³»

3. **SOFA è¯„åˆ†åº”ç”¨**
   - ä½¿ç”¨ `mimiciv_derived.first_day_sofa` è¡¨
   - åˆ†æå„å™¨å®˜ç³»ç»ŸåŠŸèƒ½éšœç¢
   - è¯„ä¼°ç–¾ç—…ä¸¥é‡ç¨‹åº¦

### æ‰©å±•åŠŸèƒ½
1. åˆ›å»ºè‡ªå®šä¹‰æ´¾ç”Ÿè¡¨
2. å¼€å‘æ•°æ®å¯è§†åŒ–å·¥å…·
3. æ„å»ºé¢„æµ‹æ¨¡å‹
4. ç¼–å†™è‡ªåŠ¨åŒ–åˆ†ææµç¨‹

---

## æ€»ç»“

### å·²å®Œæˆ âœ…
- âœ… å®‰è£… skill-seekers å·¥å…·
- âœ… åˆ›å»º MIMIC-IV æ•°æ®æå–æŠ€èƒ½ï¼ˆ28KB æ–‡æ¡£ï¼‰
- âœ… é…ç½® PostgreSQL æ•°æ®åº“è¿æ¥
- âœ… æ¢ç´¢å®Œæ•´æ•°æ®åº“ç»“æ„ï¼ˆ111ä¸ªè¡¨ï¼‰
- âœ… è·å–å®é™…æ•°æ®ç»Ÿè®¡
- âœ… å‘ç°é¢„è®¡ç®—è¡¨ï¼ˆSOFAã€Sepsisã€AKIï¼‰
- âœ… åˆ›å»ºæ–‡æ¡£å’Œå·¥å…·è„šæœ¬
- âœ… æä¾›å¿«é€Ÿå¼€å§‹ç¤ºä¾‹

### å¯ç”¨èµ„æº ğŸ“š
- **æŠ€èƒ½æ–‡æ¡£**: å®Œæ•´çš„ SQL æ¨¡å¼å’Œ itemid å‚è€ƒ
- **æ•°æ®åº“**: 364,627 æ‚£è€…ï¼Œ94,458 ICU ä½é™¢
- **é¢„è®¡ç®—è¡¨**: 41,295 è„“æ¯’ç—‡ç—…ä¾‹å·²è¯†åˆ«
- **å·¥å…·**: æ•°æ®åº“è¿æ¥ã€æŸ¥è¯¢ã€æ¢ç´¢å·¥å…·
- **æ–‡æ¡£**: ä¸­è‹±æ–‡å®Œæ•´æ–‡æ¡£

### å‡†å¤‡å°±ç»ª ğŸš€
ä½ ç°åœ¨å·²ç»å®Œå…¨å‡†å¤‡å¥½å¼€å§‹ MIMIC-IV æ•°æ®åˆ†æï¼

æ‰€æœ‰å·¥å…·ã€æŠ€èƒ½ã€è¿æ¥éƒ½å·²é…ç½®å®Œæˆï¼Œå¯ä»¥ç›´æ¥å¼€å§‹ä½ çš„ SOFA/Sepsis/AKI ç ”ç©¶äº†ï¼

---

**åˆ›å»ºæ—¥æœŸ**: 2025å¹´11æœˆ14æ—¥
**ä½œè€…**: Claude AI
**é¡¹ç›®**: SaAki_Sofa_benchmark
