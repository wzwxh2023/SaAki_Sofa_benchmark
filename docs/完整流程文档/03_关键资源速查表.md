# MIMIC-IV å…³é”®èµ„æºé€ŸæŸ¥è¡¨

**å¿«é€Ÿå‚è€ƒ**: å¸¸ç”¨è¡¨ã€ItemIDã€SQL æ¨¡å¼

---

## ğŸ“Š æ ¸å¿ƒè¡¨å¿«é€Ÿå‚è€ƒ

### æ‚£è€…å’Œä½é™¢ä¿¡æ¯

| è¡¨å | Schema | è¡Œæ•° | ä¸»é”® | è¯´æ˜ |
|------|--------|------|------|------|
| **patients** | mimiciv_hosp | 364,627 | subject_id | æ‚£è€…äººå£ç»Ÿè®¡å­¦ |
| **admissions** | mimiciv_hosp | 546,028 | hadm_id | ä½é™¢ä¿¡æ¯ |
| **icustays** | mimiciv_icu | 94,458 | stay_id | ICU ä½é™¢ |

**å¸¸ç”¨æŸ¥è¯¢**:
```sql
-- åŸºç¡€æ‚£è€…ä¿¡æ¯
SELECT p.subject_id, p.gender, p.anchor_age, p.dod
FROM mimiciv_hosp.patients p
WHERE p.anchor_age >= 18;

-- ICU ä½é™¢ä¿¡æ¯
SELECT ie.stay_id, ie.subject_id, ie.hadm_id,
       ie.intime, ie.outtime, ie.los
FROM mimiciv_icu.icustays ie;
```

---

## ğŸ”¢ å¸¸ç”¨ ItemID

### ç”Ÿå‘½ä½“å¾ (chartevents)

| ItemID | åç§° | å•ä½ | è¯´æ˜ |
|--------|------|------|------|
| **220045** | Heart Rate | bpm | å¿ƒç‡ |
| **220210** | Respiratory Rate | bpm | å‘¼å¸é¢‘ç‡ |
| **220277** | SpO2 | % | è¡€æ°§é¥±å’Œåº¦ |
| **220179** | Systolic BP (éä¾µå…¥) | mmHg | æ”¶ç¼©å‹ |
| **220180** | Diastolic BP (éä¾µå…¥) | mmHg | èˆ’å¼ å‹ |
| **220181** | MAP (éä¾µå…¥) | mmHg | å¹³å‡åŠ¨è„‰å‹ |
| **220052** | MAP (åŠ¨è„‰) | mmHg | åŠ¨è„‰å¹³å‡å‹ |
| **223761** | Temperature | Â°F | ä½“æ¸©ï¼ˆåæ°ï¼‰ |
| **223762** | Temperature | Â°C | ä½“æ¸©ï¼ˆæ‘„æ°ï¼‰ |

**ä½¿ç”¨ç¤ºä¾‹**:
```sql
SELECT charttime, valuenum, valueuom
FROM mimiciv_icu.chartevents
WHERE stay_id = 30000001
  AND itemid IN (220045, 220210, 220277, 220181)  -- HR, RR, SpO2, MAP
  AND valuenum IS NOT NULL
ORDER BY charttime;
```

---

### å®éªŒå®¤æ£€æŸ¥ (labevents)

| ItemID | åç§° | å•ä½ | è¯´æ˜ |
|--------|------|------|------|
| **50912** | Creatinine | mg/dL | è‚Œé… |
| **51265** | Platelet Count | K/uL | è¡€å°æ¿è®¡æ•° |
| **50885** | Bilirubin, Total | mg/dL | æ€»èƒ†çº¢ç´  |
| **51222** | Hemoglobin | g/dL | è¡€çº¢è›‹ç™½ |
| **51301** | White Blood Cells | K/uL | ç™½ç»†èƒè®¡æ•° |
| **50971** | Potassium | mEq/L | é’¾ |
| **50983** | Sodium | mEq/L | é’  |
| **50902** | Chloride | mEq/L | æ°¯ |
| **50882** | Bicarbonate | mEq/L | ç¢³é…¸æ°¢ç› |

**ä½¿ç”¨ç¤ºä¾‹**:
```sql
SELECT le.charttime, di.label, le.valuenum, le.valueuom, le.flag
FROM mimiciv_hosp.labevents le
JOIN mimiciv_hosp.d_labitems di ON le.itemid = di.itemid
WHERE le.subject_id = 10000032
  AND le.itemid IN (50912, 51265, 50885)  -- Cr, PLT, Bili
  AND le.valuenum IS NOT NULL
ORDER BY le.charttime;
```

---

### è¡€æ°”åˆ†æ (labevents)

| ItemID | åç§° | å•ä½ | è¯´æ˜ |
|--------|------|------|------|
| **50821** | PaO2 | mmHg | åŠ¨è„‰è¡€æ°§åˆ†å‹ |
| **50816** | FiO2 | % | å¸å…¥æ°§æµ“åº¦ |
| **50818** | PCO2 | mmHg | äºŒæ°§åŒ–ç¢³åˆ†å‹ |
| **50820** | pH | - | pH å€¼ |
| **50802** | Base Excess | mEq/L | ç¢±å‰©ä½™ |

---

### å‘¼å¸æœºè®¾ç½® (chartevents)

| ItemID | åç§° | å•ä½ | è¯´æ˜ |
|--------|------|------|------|
| **224688** | Respiratory Rate (Set) | bpm | è®¾å®šå‘¼å¸é¢‘ç‡ |
| **224689** | Tidal Volume (Set) | mL | è®¾å®šæ½®æ°”é‡ |
| **224690** | PEEP Set | cmH2O | è®¾å®š PEEP |
| **223835** | FiO2 (Set) | % | è®¾å®šå¸æ°§æµ“åº¦ |

---

## ğŸ¥ é¢„è®¡ç®—è¡¨å¿«é€Ÿå‚è€ƒ

### ä¸´åºŠè¯„åˆ†

| è¡¨å | è¡Œæ•° | è¯´æ˜ | å…³é”®å­—æ®µ |
|------|------|------|----------|
| **sofa** | 8,219,121 | SOFA æ—¶é—´åºåˆ— | stay_id, charttime, sofa_24hours |
| **first_day_sofa** | 94,458 | é¦–æ—¥ SOFA | stay_id, sofa_24hours, å„ç»„åˆ† |
| **apsiii** | - | APACHE III | stay_id, apsiii |
| **sapsii** | - | SAPS II | stay_id, sapsii |
| **oasis** | - | OASIS | stay_id, oasis |

**SOFA ç»„åˆ†å­—æ®µ**:
- `respiration_24hours` - å‘¼å¸
- `coagulation_24hours` - å‡è¡€
- `liver_24hours` - è‚åŠŸèƒ½
- `cardiovascular_24hours` - å¿ƒè¡€ç®¡
- `cns_24hours` - ä¸­æ¢ç¥ç»ç³»ç»Ÿ
- `renal_24hours` - è‚¾åŠŸèƒ½

---

### è„“æ¯’ç—‡å’Œæ„ŸæŸ“

| è¡¨å | è¡Œæ•° | è¯´æ˜ | å…³é”®å­—æ®µ |
|------|------|------|----------|
| **sepsis3** | 41,295 | Sepsis-3 | stay_id, sepsis3, sofa_24hours |
| **sepsis3_detail** | - | è¯¦ç»†ä¿¡æ¯ | stay_id, suspected_infection_time |
| **suspicion_of_infection** | - | æ„ŸæŸ“æ€€ç–‘ | stay_id, antibiotic_time, culture_time |

---

### æ€¥æ€§è‚¾æŸä¼¤

| è¡¨å | è¡Œæ•° | è¯´æ˜ | å…³é”®å­—æ®µ |
|------|------|------|----------|
| **kdigo_stages** | 5,099,899 | AKI åˆ†æœŸæ—¶é—´åºåˆ— | stay_id, charttime, aki_stage |
| **kdigo_creatinine** | - | åŸºäºè‚Œé… | stay_id, creatinine, aki_stage_creat |
| **kdigo_uo** | - | åŸºäºå°¿é‡ | stay_id, uo_6hr, aki_stage_uo |
| **creatinine_baseline** | - | åŸºçº¿è‚Œé… | stay_id, creatinine_baseline |

**AKI åˆ†æœŸ**:
- Stage 1: Cr â‰¥ 0.3 mg/dL æˆ– â‰¥ 1.5x åŸºçº¿
- Stage 2: Cr â‰¥ 2x åŸºçº¿
- Stage 3: Cr â‰¥ 3x åŸºçº¿ æˆ– â‰¥ 4.0 mg/dL

---

### é¦–æ—¥æµ‹é‡å€¼

| è¡¨å | è¯´æ˜ | å…³é”®å­—æ®µ |
|------|------|----------|
| **first_day_lab** | é¦–æ—¥å®éªŒå®¤ | glucose, potassium, sodium, hematocrit, wbc, creatinine |
| **first_day_vitalsign** | é¦–æ—¥ç”Ÿå‘½ä½“å¾ | heart_rate, sbp, dbp, mbp, resp_rate, temperature, spo2 |
| **first_day_urine_output** | é¦–æ—¥å°¿é‡ | urineoutput |
| **first_day_gcs** | é¦–æ—¥ GCS | gcs_min, gcs_motor, gcs_verbal, gcs_eyes |
| **first_day_bg** | é¦–æ—¥è¡€æ°” | pao2, paco2, ph, baseexcess |

---

### è¯ç‰©

| è¡¨å | è¯´æ˜ | å…³é”®å­—æ®µ |
|------|------|----------|
| **norepinephrine** | å»ç”²è‚¾ä¸Šè…ºç´  | stay_id, starttime, endtime, rate, amount |
| **epinephrine** | è‚¾ä¸Šè…ºç´  | stay_id, starttime, endtime, rate, amount |
| **dopamine** | å¤šå·´èƒº | stay_id, starttime, endtime, rate, amount |
| **vasopressin** | åŠ å‹ç´  | stay_id, starttime, endtime, rate, amount |
| **vasoactive_agent** | æ‰€æœ‰è¡€ç®¡æ´»æ€§è¯ | stay_id, starttime, endtime, norepinephrine_equivalent_dose |

---

### ç”Ÿå‘½æ”¯æŒ

| è¡¨å | è¯´æ˜ | å…³é”®å­—æ®µ |
|------|------|----------|
| **ventilation** | æœºæ¢°é€šæ°” | stay_id, ventilation_status, starttime, endtime |
| **ventilator_setting** | å‘¼å¸æœºè®¾ç½® | stay_id, charttime, respiratory_rate, tidal_volume, peep, fio2 |
| **rrt** | è‚¾è„æ›¿ä»£æ²»ç–— | stay_id, charttime, rrt |
| **crrt** | è¿ç»­è‚¾è„æ›¿ä»£ | stay_id, charttime, crrt_mode |

---

## ğŸ“ å¸¸ç”¨ SQL æ¨¡å¼

### æ¨¡å¼ 1ï¼šæ‚£è€…é˜Ÿåˆ—

```sql
-- æˆäºº ICU æ‚£è€…ï¼Œä½é™¢æ—¶é—´ â‰¥ 1 å¤©
SELECT
    ie.stay_id,
    ie.subject_id,
    ie.hadm_id,
    p.gender,
    p.anchor_age,
    ie.intime,
    ie.outtime,
    ie.los,
    a.hospital_expire_flag
FROM mimiciv_icu.icustays ie
INNER JOIN mimiciv_hosp.patients p ON ie.subject_id = p.subject_id
INNER JOIN mimiciv_hosp.admissions a ON ie.hadm_id = a.hadm_id
WHERE p.anchor_age >= 18
  AND ie.los >= 1;
```

---

### æ¨¡å¼ 2ï¼šè„“æ¯’ç—‡ + SOFA + AKI

```sql
-- è„“æ¯’ç—‡æ‚£è€…çš„å®Œæ•´ä¸´åºŠæ•°æ®
SELECT
    s.stay_id,
    s.sepsis3,
    s.sofa_24hours,
    fs.respiration_24hours,
    fs.coagulation_24hours,
    fs.liver_24hours,
    fs.cardiovascular_24hours,
    fs.cns_24hours,
    fs.renal_24hours,
    k.max_aki_stage,
    ie.los,
    p.anchor_age,
    a.hospital_expire_flag
FROM mimiciv_derived.sepsis3 s
INNER JOIN mimiciv_derived.first_day_sofa fs ON s.stay_id = fs.stay_id
LEFT JOIN (
    SELECT stay_id, MAX(aki_stage) as max_aki_stage
    FROM mimiciv_derived.kdigo_stages
    GROUP BY stay_id
) k ON s.stay_id = k.stay_id
INNER JOIN mimiciv_icu.icustays ie ON s.stay_id = ie.stay_id
INNER JOIN mimiciv_hosp.patients p ON s.subject_id = p.subject_id
INNER JOIN mimiciv_hosp.admissions a ON s.hadm_id = a.hadm_id
WHERE s.sepsis3 = true;
```

---

### æ¨¡å¼ 3ï¼šç”Ÿå‘½ä½“å¾æ—¶é—´åºåˆ—

```sql
-- æå– ICU ä½é™¢æœŸé—´çš„ç”Ÿå‘½ä½“å¾
SELECT
    v.stay_id,
    v.charttime,
    EXTRACT(EPOCH FROM (v.charttime - ie.intime))/3600 as hours_since_admission,
    v.heart_rate,
    v.sbp,
    v.dbp,
    v.mbp,
    v.resp_rate,
    v.temperature,
    v.spo2
FROM mimiciv_derived.vitalsign v
INNER JOIN mimiciv_icu.icustays ie ON v.stay_id = ie.stay_id
WHERE v.stay_id = ?
ORDER BY v.charttime;
```

---

### æ¨¡å¼ 4ï¼šå®éªŒå®¤å€¼ + å‚è€ƒèŒƒå›´

```sql
-- æå–å®éªŒå®¤å€¼å¹¶æ ‡æ³¨å¼‚å¸¸
SELECT
    le.charttime,
    di.label,
    le.valuenum,
    le.valueuom,
    le.ref_range_lower,
    le.ref_range_upper,
    le.flag,
    CASE
        WHEN le.valuenum < le.ref_range_lower THEN 'Low'
        WHEN le.valuenum > le.ref_range_upper THEN 'High'
        ELSE 'Normal'
    END as interpretation
FROM mimiciv_hosp.labevents le
INNER JOIN mimiciv_hosp.d_labitems di ON le.itemid = di.itemid
WHERE le.hadm_id = ?
  AND di.label IN ('Creatinine', 'Platelet Count', 'Bilirubin, Total')
  AND le.valuenum IS NOT NULL
ORDER BY di.label, le.charttime;
```

---

### æ¨¡å¼ 5ï¼šè¯ç‰©æš´éœ²

```sql
-- è¡€ç®¡æ´»æ€§è¯ç‰©ä½¿ç”¨
SELECT
    va.stay_id,
    va.starttime,
    va.endtime,
    va.endtime - va.starttime as duration,
    va.norepinephrine_equivalent_dose
FROM mimiciv_derived.vasoactive_agent va
WHERE va.stay_id = ?
ORDER BY va.starttime;
```

---

## ğŸ” æŸ¥æ‰¾è¡¨å’Œå­—æ®µ

### æŸ¥çœ‹æ‰€æœ‰è¡¨

```sql
-- æŸ¥çœ‹æŸä¸ª schema çš„æ‰€æœ‰è¡¨
SELECT table_name
FROM information_schema.tables
WHERE table_schema = 'mimiciv_derived'
ORDER BY table_name;
```

### æŸ¥çœ‹è¡¨ç»“æ„

```sql
-- æŸ¥çœ‹è¡¨çš„æ‰€æœ‰åˆ—
SELECT
    column_name,
    data_type,
    is_nullable
FROM information_schema.columns
WHERE table_schema = 'mimiciv_derived'
  AND table_name = 'sepsis3'
ORDER BY ordinal_position;
```

### æŸ¥æ‰¾ ItemID

```sql
-- åœ¨ d_items ä¸­æœç´¢
SELECT itemid, label, category
FROM mimiciv_icu.d_items
WHERE label ILIKE '%heart rate%';

-- åœ¨ d_labitems ä¸­æœç´¢
SELECT itemid, label, fluid, category
FROM mimiciv_hosp.d_labitems
WHERE label ILIKE '%creatinine%';
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. å§‹ç»ˆé™åˆ¶ç»“æœ

```sql
-- å…ˆç”¨ LIMIT æµ‹è¯•
SELECT * FROM large_table LIMIT 100;

-- ç¡®è®¤åå†å…¨é‡æŸ¥è¯¢
```

### 2. ä¼˜å…ˆä½¿ç”¨é¢„è®¡ç®—è¡¨

```sql
-- âŒ æ…¢ï¼šä» chartevents è®¡ç®—
SELECT ... FROM mimiciv_icu.chartevents ...

-- âœ… å¿«ï¼šä½¿ç”¨ vitalsign
SELECT ... FROM mimiciv_derived.vitalsign ...
```

### 3. è¿‡æ»¤ç­–ç•¥

```sql
-- âœ… å¥½ï¼šå…ˆæŒ‰ stay_id è¿‡æ»¤
WHERE stay_id IN (...)
  AND itemid = 220045

-- âŒ å·®ï¼šå…ˆæŒ‰ itemid è¿‡æ»¤å…¨è¡¨
WHERE itemid = 220045
```

### 4. ä½¿ç”¨ IN æ›¿ä»£å¤šä¸ª OR

```sql
-- âœ… å¥½
WHERE itemid IN (220045, 220210, 220277)

-- âŒ å·®
WHERE itemid = 220045 OR itemid = 220210 OR itemid = 220277
```

---

## ğŸ¯ ä¸´åºŠæ¦‚å¿µè®¡ç®—

### SOFA è¯„åˆ†é˜ˆå€¼

| ç»„åˆ† | 0åˆ† | 1åˆ† | 2åˆ† | 3åˆ† | 4åˆ† |
|------|-----|-----|-----|-----|-----|
| **å‘¼å¸ (PaO2/FiO2)** | â‰¥400 | <400 | <300 | <200 | <100 |
| **å‡è¡€ (è¡€å°æ¿, K/uL)** | â‰¥150 | <150 | <100 | <50 | <20 |
| **è‚åŠŸèƒ½ (èƒ†çº¢ç´ , mg/dL)** | <1.2 | 1.2-1.9 | 2.0-5.9 | 6.0-11.9 | â‰¥12.0 |
| **å¿ƒè¡€ç®¡ (MAP, è¡€ç®¡æ´»æ€§è¯)** | MAPâ‰¥70 | MAP<70 | å¤šå·´èƒºâ‰¤5æˆ–å¤šå·´é…šä¸èƒº | å¤šå·´èƒº>5æˆ–å»ç”²/è‚¾ä¸Šâ‰¤0.1 | å¤šå·´èƒº>15æˆ–å»ç”²/è‚¾ä¸Š>0.1 |
| **ä¸­æ¢ç¥ç» (GCS)** | 15 | 13-14 | 10-12 | 6-9 | <6 |
| **è‚¾åŠŸèƒ½ (è‚Œé…, mg/dL)** | <1.2 | 1.2-1.9 | 2.0-3.4 | 3.5-4.9 | â‰¥5.0 |

---

### KDIGO AKI æ ‡å‡†

**è‚Œé…æ ‡å‡†**:
- Stage 1: å¢åŠ  â‰¥ 0.3 mg/dL **æˆ–** â‰¥ 1.5-1.9x åŸºçº¿
- Stage 2: å¢åŠ  â‰¥ 2.0-2.9x åŸºçº¿
- Stage 3: å¢åŠ  â‰¥ 3x åŸºçº¿ **æˆ–** â‰¥ 4.0 mg/dL

**å°¿é‡æ ‡å‡†**:
- Stage 1: < 0.5 mL/kg/h Ã— 6-12 å°æ—¶
- Stage 2: < 0.5 mL/kg/h Ã— â‰¥ 12 å°æ—¶
- Stage 3: < 0.3 mL/kg/h Ã— â‰¥ 24 å°æ—¶ **æˆ–** æ— å°¿ â‰¥ 12 å°æ—¶

---

### Sepsis-3 æ ‡å‡†

**æ„ŸæŸ“æ€€ç–‘**:
- æŠ—ç”Ÿç´  + å¾®ç”Ÿç‰©åŸ¹å…»
- åœ¨ 24 å°æ—¶çª—å£å†…

**å™¨å®˜åŠŸèƒ½éšœç¢**:
- SOFA è¯„åˆ†å¢åŠ  â‰¥ 2 åˆ†

---

## ğŸ“ å¿«é€Ÿè®¿é—®æ–‡ä»¶

### Python å·¥å…·
```python
from utils.db_helper import query_to_df, preview_table, get_table_info
```

### æ–‡æ¡£ä½ç½®
- æŠ€èƒ½æ–‡æ¡£: `.claude/skills/mimiciv-data-extraction/SKILL.md`
- æ•°æ®åº“æ‘˜è¦: `MIMICIV_Database_Summary.md`
- å®Œæ•´æµç¨‹: `docs/å®Œæ•´æµç¨‹æ–‡æ¡£/01_å®Œæ•´æµç¨‹æ€»ç»“.md`
- å¿«é€Ÿå¼€å§‹: `docs/å®Œæ•´æµç¨‹æ–‡æ¡£/02_å¿«é€Ÿå¼€å§‹æŒ‡å—.md`

---

**æœ€åæ›´æ–°**: 2025-11-14
